## 2020.1.4 天气 晴

&emsp;&emsp;老师傅今天一次性给我发了34个redis应用场景，
我估计他寻思我能玩一周，试试看，以下是任务列表：   

&emsp;&emsp;计划是先一次性整理出各题目的实现思路，再按照数据类型分配去代码实现  
&emsp;&emsp;不会的就问！  

1. 使用redis 实现的缓存机制				     	
__完成__
2. 使用redis实现最简单的分布式锁
解：
&emsp;&emsp;分布式锁解决的2个问题的是：  
① 解决多用户操作的幂等性问题  --> 比如避免用户重复提交导致出现多条相同的订单  
② 把多用户的并行操作转换为串行操作  ---> 高并发减库存  
redis分布式锁实现靠自身的原子性， 但需要注意的是：setnx和expire是两个操作步骤, 这样是无法保证原子性的哦     
所以有了：
```shell
SET key value [NX] [XX] [EX<seconds>] [PX <millseconds>] 
SET： 命令
key： 待设置的key
value: 设置的key的value

可选参数
NX: 表示key不存在的时候才设置，如果存在返回NULL
XX: 表示key存在的时候才设置，如果不存在则返回NULL
EX seconds: 设置过期时间，过期时间精确为秒
PX millsecond: 设置过期时间， 过期时间精确为毫秒
```
所以，原生的API实现就是： SET my_lock true NX px 600000
给出的springboot实现请移步： `run.zykj.app.subject2`    
__完成__  

3. 博客的发布与查看  
?

4. 博客字数统计与文章预览  
解： 原生API： STRLEN key  
Java代码实现场景，如果只是字符串，直接根据key拿到string取length即可  
__完成__  

5. 用户操作日志审计功能
?

6. 实现一个简单的唯一id生成器
解：原生API 就是调用incr 命令  
Java代码实现场景： 可以直接调用api：redisTemplate.opsForValue().increment(key,increment);  
__完成__  

7. 实现博客点赞次数计数器
思路： 点赞的技术就在于要判断该用户是否已经点赞， 已重复的点赞即取消点赞或直接无效  
因为是需要去重的，那就上set数据类型  
解：  原生API  
① 点赞   
```java
sadd like:xxx作品id xx用户id  
```
② 取消点赞    
```java
srem like:xxx作品id xx用户id  
```
③ 查看当前点赞用户  
```java
smembers like:xxx作品id
```
Java代码实现场景, 请移步：`run.zykj.app.subject7`  
__完成__ 

8. 社交网站的网址点击追踪实战  
不太明白这个点击追踪实战是什么意思？是指短链接吗？  
短链接的实现可以用hash数据类型和摘要算法（或者发号器+62位 前者存在碰撞， 后者永不重复）
直接是Java代码实现场景, 请移步： `run.zykj.app.subject8`  
__如果不考虑集群的架构以及一对多的情况 只做单点会很简单 完成__ 

9. 博客网站案例代码重构（__暂时不做__）

10. 基于令牌的用户登录会话机制  
__已在某demo实现__ 

11. 秒杀活动下的公平队列抢购机制  
思路：  就用list数据结构  之前理解错了 不应该存储用户请求 应该存储商品的ID
然后模拟多用户，并发去抢购这个限定数量的商品 lpush插入商品之后是栈的结构 rpop是则可以取出并返回栈底的元素 
到时候某一个线程去抢购的时候  就看有没有返回对象 如果存在返回对象 那么就抢购成功  


12. 博客网站的分页浏览  
思路： 采用list的LRANGE命令 指定 start stop即可  
原生API： LRANGE key start stop  
__完成__ 

13. 实现oa系统中的待办事项列表管理  
思路： list数据结构
__完成__ 

14. 网站用户注册的时候邮件验证机制  
思路： 生成一个与用户id相关联的随机链接， 未点击验证时设置value为false， 点击验证后设置value为true， 选择数据结构为hash  
解： `run.zykj.app.subject14`
__完成__

15. 网站每日 uv 数据指标去重统计  
思路： 看到下面有个hyperloglog统计UV 然后这道题又指明的去重， 表明就是set数据类型  
那就直接当一个请求过来时，我们使用 sadd 将用户 ID 塞进去就可以了，然后当凌晨的时候统计人数就可以了
解：  
原生API：  
```java
sadd UV_2021_1_4 XX用户ID
sadd UV_2021_1_4 XX用户ID
...
```
java代码实现场景： 直接实现取出就是.size()罢了
__完成__ 

16. 博客网站的文章标签管理  

17. 朋友圈点赞功能的实现  
同7
__完成__

18. 类似微博的社交关系
思路： 指的是随机好友吗？ 
随机好友实现：  先把数据准备好，把所有需要展示的内容存入redis的Set数据结构中    
步骤2：通过srandmember命令随机拿一批数据出来  
__简易版本完成__

19. 实现网站上的抽奖程序
思路：  set数据结构 因为它支持随机选取
①京东：  
京豆抽奖：奖品是可以重复，例如抽5京豆可以再抽到5京豆，即京豆是无限量抽  
1、set集合的特点是元素不重复 存放1个 5个 10个京豆 谢谢参与  
2、具体的技术方案是采用set集合的srandmember命令来实现，随机返回set的一个元素 
3、这里只要设置好你的每个豆子的概率就行 
②支付宝：  
支付宝的抽奖要用spop命令，即随机返回并删除set中一个元素  
因为它扣， 不能让每个人都中一个  
__简易版本完成__

20. 微博的共同关注与推荐关注
思路：用set数据结构实现  
就是比如说我关注了雷军： 那么我就是雷军的粉丝Fans  
雷军被我关注了，那么雷军就是我的关注follower  
那么，注意这里就是每个用户有2个集合：  关注和粉丝
集合key的设计：
我的关注集合: key=follower:雷军id
雷军的粉丝集合： key=fans:我id
__这个简易版也很简单， 就是两次sadd操作，分清什么对象往什么集合内插入就可以了__

21. 为商品搜索构建反向索引
思路： 反向索引 = 倒排索引 难点反而在中文分词  词义分析上  
ID1：梅林红烧肉罐头
ID2：梅林番茄炖肉罐头

	1	2  
梅林	*	*  
红烧	*  
肉	*	*  
罐头	*	*  
番茄		*  
炖肉		*  


22. 实现音乐网站的排行榜程序
思路：排行榜的实现毫无疑问的是采用zset数据类型，因为有序集合的成员是唯一的,但分数(score)却可以重复  
设定排行表的时候为每个音乐网站指定一个点击数字段 然后设定定时任务 在每日的凌晨进行摘取排名在前5的网站：  
```mysql
select ifnull(
    (select distinct 字段 from music_table order by count desc limit 5)
, null)
取出后赋给zset，随后Zrevrange key start stop 就可以了    
```
实现请移步: `run.zykj.app.subject22`  

23. 实现一个新闻推荐机制
思路： 布隆过滤器？

24. 购买此商品的顾客也同时购买了
思路：  

25. 网站搜索框的自动补全功能
思路：脑内唯一可以匹配的知识点就是模糊查询  
进行一系列的百度后， 发现是zset实现  
1、首先把一个单词拆分开来， 比如nba是
n
nb
nba 
加入到zset集合中，添加时要求source都为0
2、好了，准备工作完了，进行下一步，搜索以nb开头的 ,我们可以通过zrank命令轻松定位到nb的位置(index),然后通过index获取从nb开头的有序集合。
3、如何取到需要的单词呢， 在录入redis的时候往单词的后缀上添加*

如果只是这样的拆词 
就是每次截取的字符串长度加1而已
__完成__

26. 基于hyperloglog的网站uv统计
思路： HyperLogLog 目前只支持3个命令，PFADD、PFCOUNT、PFMERGE  不过我在Redistemplate上没用过  
HyperLogLog是可以合并的， __这个麻烦在理解合并上吧__

27. 网站重复垃圾数据的快速去重和过滤
又一个布隆过滤器？

28. 日活跃用户数，月活跃用户数，年活跃用户数的统计
思路： 这个是位图

29. 基于位图的网站用户行为记录程序

30. 基于geohash 你与商铺距离计算的程序
思路： Redis GEO  

31. 陌生人社交app里查找附近的人功能
思路： Redis GEO  

--------------------------------------------------

32. 带有自动过期时间的分布式缓存实现

33. 支持超时自动释放的分布式缓存时间

34. 支持自动过期的用户登录会话实现

35. 支持冷数据自动淘汰的自动补全程序

36. 支持身份验证的分布式锁释放机制


